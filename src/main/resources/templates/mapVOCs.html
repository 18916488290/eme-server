<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/map-layout :: headFragment">
<!-- <title id="pageTitle">ç©ºæ°”è´¨é‡ç›‘æµ‹ä¸“é¢˜</title>-->
</head>
<body>
	<!-- HEADER -->
	<header class="navbar clearfix navbar-fixed-top" id="header"
		th:include="fragments/map-layout :: headerFragment"> </header>
	<!--/HEADER -->

	<!-- PAGE -->
	<section id="page">
		<!-- SIDEBAR -->
		<div id="sidebar" class="sidebar"
			th:include="fragments/map-layout :: sidebarFragment"></div>
		<!-- /SIDEBAR -->
		<!-- maincontent -->
		<div id="main-content"
			th:include="fragments/map-layout :: main-contentFragment">
			<!-- BREADCRUMBS -->
			<ul class="breadcrumb" id="BREADCRUMBS">
				<li><i class="fa fa-home"></i> <a href="index.html"  th:href="@{/}">ä¸»ç•Œé¢</a></li>
				<li><a href="#"  th:href="@{/mapVOCs}">æŒ¥å‘æ€§æœ‰æœºç‰©(VOCs)ä¸“é¢˜</a></li>
			</ul>
			<!-- /BREADCRUMBS -->

	
			<!-- mainContentBox -->
			<div id="mainContentBox">
				  <div class="gmaps" id="baidumap"></div>  
				  <!-- 
				  <div class="alert alert-block alert-warning fade in">
					<p><i class="fa fa-exclamation-circle"></i>å—é€šåŠ±åŸç”Ÿç‰©å·¥ç¨‹æœ‰é™å…¬å¸ï¼š æ°¯åŒ–æ°¢ï¼Œè‹¯ï¼Œéç”²çƒ·æ€»çƒƒè¶…æ ‡ï¼Œ ç›‘æµ‹æ—¶é—´ 2016-3-8 14:00ï¼Œ ç³»ç»Ÿå·²ç»é€šçŸ¥ç›¸å…³è´£ä»»äºº</p>
				    <p><i class="fa fa-exclamation-circle"></i>å—é€šæ˜Ÿè¾°åˆæˆææ–™æœ‰é™å…¬å¸ï¼š è‹¯ï¼Œéç”²çƒ·æ€»çƒƒè¶…æ ‡ï¼Œ ç›‘æµ‹æ—¶é—´ 2016-3-8 14:00ï¼Œ ç³»ç»Ÿå·²ç»é€šçŸ¥ç›¸å…³è´£ä»»äºº</p>
				  </div>
				  -->
	              <div id="w" class="easyui-window" title="å‚åŒºVOCsç›‘æµ‹ä¿¡æ¯" data-options="left:800,top:54,minimizable:false">
				  <div class="easyui-panel" title="" style="width:440px;">
										<table cellpadding="0" cellspacing="0" border="0" class="datatable table table-striped table-bordered table-hover">
											<thead>
												<tr>
													<th>ä¼ä¸šåç§°</th>
													<th>è¡Œæ”¿åŒºåŸŸ</th>
													<th>æ“ä½œ</th>
												</tr>
											</thead>
											<tbody>
												<tr  th:each="nc : ${companies}">
													<td th:text="${nc.companyName}">ä¼ä¸šåç§°</td>
													<td th:text="${nc.administrativeDivision.division}">è¡Œæ”¿åŒºåŸŸ</td>								
													<td>
													<a th:href="'javascript:theLocation('+${nc.id}+','+${nc.lng} + ',' +${nc.lat} + ');'"><i class="fa  fa-map-marker"></i><span>å®šä½</span></a>
													<a th:href="'javascript:localSearch('+${nc.id}+','+${nc.lng} + ',' +${nc.lat} + ',\'å­¦æ ¡\');'"><i class="fa"></i><span>ğŸ«å­¦æ ¡</span></a>
													<a th:href="'javascript:localSearch('+${nc.id}+','+${nc.lng} + ',' +${nc.lat} + ',\'åŒ»é™¢\');'"><i class="fa"></i><span>ğŸ¥åŒ»é™¢</span></a>
													</td>
												</tr>
									
											</tbody>
											
										</table>
								
								</div>
						
							</div>	  
			</div>
			<!-- /mainContentBox -->
		
		</div>
		<!-- /maincontent -->
	</section>

    <div th:include="fragments/map-layout :: footerFragment"></div>
	<!--/PAGE -->
	<!-- JAVASCRIPTS -->
	<!-- Placed at the end of the document so the pages load faster -->
	<!-- JQUERY -->
	<div th:include="fragments/map-layout :: jsFragment"></div>
	<script>
		jQuery(document).ready(function() {	
			$('#w').window('collapse');
			App.setPage("mapVOCs");  //Set current page 
			App.init(); //Initialise plugins and elements
		});
	</script>
	<script th:inline="javascript">
    /*<![CDATA[*/
    var d = new Date();
	var c_date = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();                
    var map = new BMap.Map("baidumap");
    baiduMaps.init(map);
    addMapOverlay(-1000);//å‘åœ°å›¾æ·»åŠ è¦†ç›–ç‰©
    //å®šä½
	function theLocation(sourceId,lng,lat){
		baiduMaps.theLocation(map,sourceId,lng,lat);
	}
    //æœ¬åœ°æŸ¥æ‰¾
	function localSearch(sourceId,lng,lat,s){
		baiduMaps.localSearch(map,sourceId,lng,lat,s);
    }
	 function createInfoWindow(marker){
		 var content = '<fieldset> <div  class="panel">'+
							'<div title="" class="ddv panel-body panel-body-noheader panel-body-noborder" style="padding: 2px 0px; width: 100%;">'+
								'<style type="text/css">  .dv-table td{border:1px;text-align:center;padding:2px}.dv-label{font-weight:solid;color:#15428B;}</style>'+
								'<table cellpadding="0" cellspacing="0" border="0" class="datatable table table-striped table-bordered table-hover">'+
									'<thead>'+
									    '<tr>'+
										'<th>ç›‘æµ‹æ—¶é—´</th>'+
										'<th>æ±¡æŸ“é¡¹ç›®</th>'+
										'<th>ç›‘æµ‹å€¼</th>'+
										'<th>é™å€¼</th>'+
										'<th>è¶…æ ‡</th>'+
									'</tr></thead>'+
									'<tbody>'+
									'<tr>'+
									'<td>'+c_date+' 00:00</td>'+
									'<td>é¢—ç²’ç‰©</td>'+
									'<td>0.2</td>'+
									'<td>0.5</td>'+
									'<td><span class="label label-success label-sm">æœªè¶…æ ‡</span></td>'+
								     '</tr>'+
										'<tr>'+
										'<td>'+c_date+' 00:00</td>'+
										'<td>æ°¯åŒ–æ°¢</td>'+
										'<td>0.2</td>'+
										'<td>0.15</td>'+
										'<td><span class="label label-danger label-sm">è¶…æ ‡</span></td>'+
									     '</tr>'+
											'<tr>'+
											'<td>'+c_date+' 00:00</td>'+
											'<td>ç”²è‹¯</td>'+
											'<td>0.1</td>'+
											'<td>0.05</td>'+
											'<td><span class="label label-success label-sm">æœªè¶…æ ‡</span></td>'+
										     '</tr>'+
										 	'<tr>'+
											'<td>'+c_date+' 00:00</td>'+
											'<td>äºŒç”²è‹¯</td>'+
											'<td>0.3</td>'+
											'<td>0.2</td>'+
											'<td><span class="label label-danger label-sm">è¶…æ ‡</span></td>'+
										     '</tr>'+
										 	'<tr>'+
											'<td>'+c_date+' 00:00</td>'+
											'<td>éç”²çƒ·æ€»çƒƒ</td>'+
											'<td>13</td>'+
											'<td>4</td>'+
											'<td><span class="label label-danger label-sm">è¶…æ ‡</span></td>'+
										     '</tr>'+
										 	'<tr>'+
											'<td>'+c_date+' 00:00</td>'+
											'<td>é“…åŠå…¶åŒ–åˆç‰©</td>'+
											'<td>0.0004</td>'+
											'<td>0.006</td>'+
											'<td><span class="label label-success label-sm">æœªè¶…æ ‡</span></td>'+
										     '</tr>'+
											 	'<tr>'+
												'<td>'+c_date+' 00:00</td>'+
												'<td>æ±åŠå…¶åŒ–åˆç‰©</td>'+
												'<td>0.0001</td>'+
												'<td>0.0003</td>'+
												'<td><span class="label label-success label-sm">æœªè¶…æ ‡</span></td>'+
											     '</tr>'+
										 
									'</tbody>'+
								'</table>'+
								'<a href="vocsInfo?companyId='+marker.riskSourceInfo.companyId+'" target="_blank" style="width:120px">æŸ¥çœ‹è¯¦ç»†</a>'+
							'</div>'+
						'</div>'+
						'</fieldset>';
			var infoWindow = new BMapLib.SearchInfoWindow(map, content, {
				title: "å‚åŒºVOCs:" +marker.riskSourceInfo.companyName, //æ ‡é¢˜
				offset: new BMap.Size(0,7),
				width: 400,//å®½åº¦
				//height: 140, //é«˜åº¦
				panel : "panel", //æ£€ç´¢ç»“æœé¢æ¿
				enableAutoPan : true, //è‡ªåŠ¨å¹³ç§»
				searchTypes :[
				]
			});
		return infoWindow;
	 }
    function addMapOverlay(sourceId){
        $.getCompanyMarkers(function(data){
                       var markers=data;
                         for(var index = 0; index < markers.length; index++ ){
                           var point = new BMap.Point(markers[index].point.lng,markers[index].point.lat);
                           var marker;
                           if(sourceId==markers[index].riskSourceInfo.companyId)
                        	 {
                                marker = new BMap.Marker(point,{icon:new BMap.Icon("img/mapimg/waterstation-active.png",new BMap.Size(21,35),{
                                   imageOffset: new BMap.Size(markers[index].imageOffset.width,markers[index].imageOffset.height)
                                 })});
                                var selectedWin=createInfoWindow(markers[index]);
                                selectedWin.open(point);
                        	 }
                           else
                        	   { 
                        	   marker  = new BMap.Marker(point,{icon:new BMap.Icon("img/mapimg/waterstation.png",new BMap.Size(21,35),{
                                   imageOffset: new BMap.Size(markers[index].imageOffset.width,markers[index].imageOffset.height)
                               })});
                        	   
                        	   }
                           
             
                   		  var searchInfoWindow=createInfoWindow(markers[index]);
                           baiduMaps.addClickHandler(marker,searchInfoWindow);
                           map.addOverlay(marker);
                         };
         });
         
    }

   /*]]>*/
  </script>
	<!-- /JAVASCRIPTS -->
</body>
</html>